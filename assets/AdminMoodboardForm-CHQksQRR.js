import{e as J,f as Q,d as Y,r as l,j as e,l as W,B as m,X as D}from"./index-fZ_4v1pA.js";import{A as B}from"./AdminHeader-pBLznoy7.js";import{I as p}from"./input-BKC103na.js";import{L as c}from"./label-3Zkcxr3N.js";import{I as Z,T as $,S as ee}from"./ImageUploadField-l6GAsACz.js";import{C as f,a as v,b,d as N}from"./card-B3KlpYA-.js";import{C as se}from"./checkbox-rxtmnzuM.js";import{p as te}from"./products.api-g6wHoEOU.js";import{m as ae}from"./moodboards.api-CSZKZZYZ.js";import{b as q}from"./admin.api-C7JOjN0i.js";import{S as re}from"./SEO-CJ6FqJ39.js";import{A as ie}from"./arrow-left-CBAx9yF3.js";import{S as oe}from"./search-ewGgIG-S.js";import"./dropdown-menu-Mh0D0jpL.js";import"./house-BCGUpAir.js";import"./index-C24RUjyj.js";import"./circle-check-DGNRTphh.js";import"./circle-alert-DKYdrc5d.js";import"./index-Gc2GZ3r9.js";function Ie(){var L,M;const{id:n}=J(),o=!!n,u=Q(),{toast:d}=Y(),[h,y]=l.useState(!1),[R,w]=l.useState(o),[C,U]=l.useState([]),[x,H]=l.useState(""),[t,i]=l.useState({title:"",slug:"",description:"",coverImage:"",coverBlurhash:void 0,productIds:[],tags:[],isFeatured:!1,stylingTips:[],howToWear:""}),[T,S]=l.useState(""),[F,I]=l.useState(""),[le,de]=l.useState(null);l.useEffect(()=>{z(),o&&n&&K(n)},[n,o]);const z=async()=>{try{const s=await te.getAllProducts({limit:1e3});U(s.data)}catch{d({title:"Error",description:"Failed to load products",variant:"destructive"})}},K=async s=>{var a;try{w(!0);const r=await ae.getMoodboardById(s);r&&i({title:r.title,slug:r.slug,description:r.description||"",coverImage:r.coverImage,productIds:((a=r.products)==null?void 0:a.map(j=>j.id))||[],tags:r.tags||[],isFeatured:r.isFeatured||!1,stylingTips:r.stylingTips||[],howToWear:r.howToWear||""})}catch{d({title:"Error",description:"Failed to load moodboard",variant:"destructive"}),u("/admin/moodboards")}finally{w(!1)}},V=s=>s.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,""),O=s=>{i({...t,title:s}),o||i(a=>({...a,title:s,slug:V(s)}))},E=()=>{var a;const s=T.trim().toLowerCase();s&&!((a=t.tags)!=null&&a.includes(s))&&(i({...t,tags:[...t.tags||[],s]}),S(""))},X=s=>{var a;i({...t,tags:((a=t.tags)==null?void 0:a.filter(r=>r!==s))||[]})},k=()=>{const s=F.trim();s&&(i({...t,stylingTips:[...t.stylingTips||[],s]}),I(""))},_=s=>{var a;i({...t,stylingTips:((a=t.stylingTips)==null?void 0:a.filter((r,j)=>j!==s))||[]})},A=s=>{const a=t.productIds.includes(s);i({...t,productIds:a?t.productIds.filter(r=>r!==s):[...t.productIds,s]})},G=async s=>{if(s.preventDefault(),!t.title||!t.slug||!t.coverImage){d({title:"Validation Error",description:"Please fill in all required fields",variant:"destructive"});return}if(t.productIds.length===0){d({title:"Validation Error",description:"Please select at least one product",variant:"destructive"});return}y(!0);try{o&&n?(await q.updateMoodboard({...t,id:n}),d({title:"Success",description:"Moodboard updated successfully"})):(await q.createMoodboard(t),d({title:"Success",description:"Moodboard created successfully"})),u("/admin/moodboards")}catch{d({title:"Error",description:`Failed to ${o?"update":"create"} moodboard`,variant:"destructive"})}finally{y(!1)}},g=C.filter(s=>{var a;return s.name.toLowerCase().includes(x.toLowerCase())||((a=s.brand)==null?void 0:a.toLowerCase().includes(x.toLowerCase()))}),P=C.filter(s=>t.productIds.includes(s.id));return R?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(B,{}),e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx(W,{className:"w-8 h-8 animate-spin text-primary"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(re,{title:`${o?"Edit":"New"} Moodboard - Admin`,description:`${o?"Edit":"Create"} moodboard`}),e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(B,{}),e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-6xl",children:[e.jsxs(m,{variant:"ghost",onClick:()=>u("/admin/moodboards"),className:"mb-6",children:[e.jsx(ie,{className:"w-4 h-4 mr-2"}),"Back to Moodboards"]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(f,{children:[e.jsx(v,{children:e.jsx(b,{className:"font-serif text-2xl",children:o?"Edit Moodboard":"New Moodboard"})}),e.jsx(N,{children:e.jsxs("form",{onSubmit:G,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"title",children:["Title ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(p,{id:"title",value:t.title,onChange:s=>O(s.target.value),placeholder:"Parisian Chic",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"slug",children:["Slug ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(p,{id:"slug",value:t.slug,onChange:s=>i({...t,slug:s.target.value}),placeholder:"parisian-chic",required:!0})]}),e.jsx(Z,{id:"coverImage",label:"Cover Image",value:t.coverImage,onChange:s=>i({...t,coverImage:s}),required:!0,aspectRatio:"4/3",disabled:h}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"description",children:"Description"}),e.jsx($,{id:"description",value:t.description,onChange:s=>i({...t,description:s.target.value}),placeholder:"Effortlessly chic French-inspired looks...",rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"howToWear",children:"How to Wear"}),e.jsx($,{id:"howToWear",value:t.howToWear,onChange:s=>i({...t,howToWear:s.target.value}),placeholder:"Perfect for transitional weather...",rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"tags",children:"Tags"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{id:"tags",value:T,onChange:s=>S(s.target.value),onKeyPress:s=>{s.key==="Enter"&&(s.preventDefault(),E())},placeholder:"french"}),e.jsx(m,{type:"button",variant:"secondary",onClick:E,children:"Add"})]}),t.tags&&t.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:t.tags.map(s=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 bg-secondary text-secondary-foreground rounded-full text-sm",children:[s,e.jsx("button",{type:"button",onClick:()=>X(s),className:"hover:text-destructive",children:"Ã—"})]},s))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"tips",children:"Styling Tips"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{id:"tips",value:F,onChange:s=>I(s.target.value),onKeyPress:s=>{s.key==="Enter"&&(s.preventDefault(),k())},placeholder:"Pair with classic pumps"}),e.jsx(m,{type:"button",variant:"secondary",onClick:k,children:"Add"})]}),t.stylingTips&&t.stylingTips.length>0&&e.jsx("ul",{className:"space-y-2 mt-2",children:t.stylingTips.map((s,a)=>e.jsxs("li",{className:"flex items-start gap-2 p-2 bg-secondary/50 rounded text-sm",children:[e.jsx("span",{className:"flex-1",children:s}),e.jsx("button",{type:"button",onClick:()=>_(a),className:"text-destructive hover:text-destructive/80",children:e.jsx(D,{className:"w-4 h-4"})})]},a))})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(se,{id:"featured",checked:t.isFeatured,onCheckedChange:s=>i({...t,isFeatured:s})}),e.jsx(c,{htmlFor:"featured",className:"cursor-pointer",children:"Feature this moodboard"})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx(m,{type:"submit",disabled:h,className:"flex-1",children:h?e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),o?"Update":"Create"," Moodboard"]})}),e.jsx(m,{type:"button",variant:"outline",onClick:()=>u("/admin/moodboards"),children:"Cancel"})]})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(f,{children:[e.jsx(v,{children:e.jsxs(b,{className:"text-lg",children:["Selected Products (",t.productIds.length,")"]})}),e.jsx(N,{children:P.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No products selected yet"}):e.jsx("div",{className:"grid gap-3 max-h-[300px] overflow-y-auto",children:P.map(s=>e.jsxs("div",{className:"flex items-center gap-3 p-2 border rounded-lg",children:[e.jsx("img",{src:s.imageUrl,alt:s.name,className:"w-16 h-16 object-cover rounded",onError:a=>{a.currentTarget.src="https://images.unsplash.com/photo-1441986300917-64674bd600d8"}}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:s.name}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:s.brand})]}),e.jsx(m,{type:"button",variant:"ghost",size:"icon",onClick:()=>A(s.id),children:e.jsx(D,{className:"w-4 h-4"})})]},s.id))})})]}),e.jsxs(f,{children:[e.jsxs(v,{children:[e.jsx(b,{className:"text-lg",children:"Add Products"}),e.jsxs("div",{className:"relative mt-2",children:[e.jsx(oe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(p,{placeholder:"Search products...",value:x,onChange:s=>H(s.target.value),className:"pl-10"})]})]}),e.jsx(N,{children:e.jsx("div",{className:"grid gap-3 max-h-[400px] overflow-y-auto",children:(M=(L=g==null?void 0:g.filter(s=>!t.productIds.includes(s.id)))==null?void 0:L.slice(0,20))==null?void 0:M.map(s=>{var a;return e.jsxs("div",{className:"flex items-center gap-3 p-2 border rounded-lg hover:bg-accent cursor-pointer transition-colors",onClick:()=>A(s.id),children:[e.jsx("img",{src:s.imageUrl,alt:s.name,className:"w-16 h-16 object-cover rounded",onError:r=>{r.currentTarget.src="https://images.unsplash.com/photo-1441986300917-64674bd600d8"}}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:s.name}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:s.brand}),e.jsxs("p",{className:"text-xs font-semibold mt-1",children:["$",(a=s.price)==null?void 0:a.toFixed(2)]})]})]},s.id)})})})]})]})]})]})]})]})}export{Ie as default};
