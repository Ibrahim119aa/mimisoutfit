import{e as A,f as k,d as E,r as o,j as e,l as v,B as m}from"./index-Qx7ctAR2.js";import{A as y}from"./AdminHeader-DYmD83XB.js";import{I as c}from"./input-CnM6X11f.js";import{L as l}from"./label-Bxm8bHZq.js";import{I as L,T as I,S as D}from"./ImageUploadField-BZxB6JI4.js";import{C as q,a as B,b as $,d as R}from"./card-BxAvFPHz.js";import{C as V}from"./checkbox-BxBWjvHw.js";import{S as H,a as M,b as z,c as K,d as N}from"./select-C4vy7qot.js";import{p as O}from"./products.api-DatHf7P2.js";import{a as C}from"./admin.api-Dn6gOgp3.js";import{S as W}from"./SEO--jquLTE9.js";import{A as G}from"./arrow-left-DgF_MsIt.js";import"./dropdown-menu-CEi7-3xO.js";import"./house-CG1wo_RG.js";import"./index-C24RUjyj.js";import"./circle-check-DcfjYYcd.js";import"./circle-alert-CdrxB4NR.js";import"./index-Cv7ubkdg.js";function me(){const{id:d}=A(),i=!!d,u=k(),{toast:n}=E(),[p,h]=o.useState(!1),[b,g]=o.useState(i),[s,r]=o.useState({name:"",slug:"",price:null,imageUrl:"",blurhash:void 0,affiliateUrl:"",brand:"",category:"",description:"",tags:[],isFeatured:!1}),[x,f]=o.useState("");o.useEffect(()=>{i&&d&&F(d)},[d,i]);const F=async a=>{try{g(!0);const t=await O.getProductById(a);t&&r({name:t.name,slug:t.slug,price:t.price,imageUrl:t.imageUrl,affiliateUrl:t.affiliateUrl,purchaseType:t.purchaseType||"affiliate",brand:t.brand||"",category:t.category||"",description:t.description||"",tags:t.tags||[],isFeatured:t.isFeatured||!1})}catch{n({title:"Error",description:"Failed to load product",variant:"destructive"}),u("/admin/products")}finally{g(!1)}},S=a=>a.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,""),w=a=>{r({...s,name:a}),i||r(t=>({...t,name:a,slug:S(a)}))},j=()=>{var t;const a=x.trim().toLowerCase();a&&!((t=s.tags)!=null&&t.includes(a))&&(r({...s,tags:[...s.tags||[],a]}),f(""))},P=a=>{var t;r({...s,tags:((t=s.tags)==null?void 0:t.filter(U=>U!==a))||[]})},T=async a=>{if(a.preventDefault(),!s.name||!s.slug||!s.imageUrl||!s.affiliateUrl){n({title:"Validation Error",description:"Please fill in all required fields",variant:"destructive"});return}h(!0);try{i&&d?(await C.updateProduct({...s,id:d}),n({title:"Success",description:"Product updated successfully"})):(await C.createProduct(s),n({title:"Success",description:"Product created successfully"})),u("/admin/products")}catch{n({title:"Error",description:`Failed to ${i?"update":"create"} product`,variant:"destructive"})}finally{h(!1)}};return b?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(y,{}),e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx(v,{className:"w-8 h-8 animate-spin text-primary"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(W,{title:`${i?"Edit":"New"} Product - Admin`,description:`${i?"Edit":"Create"} product`}),e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(y,{}),e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-3xl",children:[e.jsxs(m,{variant:"ghost",onClick:()=>u("/admin/products"),className:"mb-6",children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"Back to Products"]}),e.jsxs(q,{children:[e.jsx(B,{children:e.jsx($,{className:"font-serif text-2xl",children:i?"Edit Product":"New Product"})}),e.jsx(R,{children:e.jsxs("form",{onSubmit:T,className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{htmlFor:"name",children:["Product Name ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(c,{id:"name",value:s.name,onChange:a=>w(a.target.value),placeholder:"Classic Trench Coat",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{htmlFor:"slug",children:["Slug ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(c,{id:"slug",value:s.slug,onChange:a=>r({...s,slug:a.target.value}),placeholder:"classic-trench-coat",required:!0})]})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"brand",children:"Brand"}),e.jsx(c,{id:"brand",value:s.brand,onChange:a=>r({...s,brand:a.target.value}),placeholder:"Burberry"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"price",children:"Price ($)"}),e.jsx(c,{id:"price",type:"number",step:"0.01",value:s.price??"",onChange:a=>r({...s,price:a.target.value?parseFloat(a.target.value):null}),placeholder:"450.00"})]})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"category",children:"Category"}),e.jsx(c,{id:"category",value:s.category,onChange:a=>r({...s,category:a.target.value}),placeholder:"outerwear"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"purchaseType",children:"Purchase Type"}),e.jsxs(H,{value:s.purchaseType||"affiliate",onValueChange:a=>r({...s,purchaseType:a}),children:[e.jsx(M,{id:"purchaseType",children:e.jsx(z,{placeholder:"Select purchase type"})}),e.jsxs(K,{children:[e.jsx(N,{value:"affiliate",children:"Affiliate Link (Default)"}),e.jsx(N,{value:"direct",children:"Direct Purchase (Contact Mimi)"})]})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:['Affiliate: Show "Shop Now" button with affiliate link',e.jsx("br",{}),'Direct: Show "Contact Mimi" button with text/WhatsApp/email options']})]})]}),e.jsx(L,{id:"imageUrl",label:"Product Image",value:s.imageUrl,onChange:a=>r({...s,imageUrl:a}),required:!0,aspectRatio:"square",disabled:p}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{htmlFor:"affiliateUrl",children:["Affiliate URL ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(c,{id:"affiliateUrl",value:s.affiliateUrl,onChange:a=>r({...s,affiliateUrl:a.target.value}),placeholder:"https://nordstrom.com/...",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"description",children:"Description"}),e.jsx(I,{id:"description",value:s.description,onChange:a=>r({...s,description:a.target.value}),placeholder:"Timeless beige trench coat perfect for all seasons...",rows:4})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"tags",children:"Tags"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{id:"tags",value:x,onChange:a=>f(a.target.value),onKeyPress:a=>{a.key==="Enter"&&(a.preventDefault(),j())},placeholder:"minimalist"}),e.jsx(m,{type:"button",variant:"secondary",onClick:j,children:"Add"})]}),s.tags&&s.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:s.tags.map(a=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 bg-secondary text-secondary-foreground rounded-full text-sm",children:[a,e.jsx("button",{type:"button",onClick:()=>P(a),className:"hover:text-destructive",children:"Ã—"})]},a))})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(V,{id:"featured",checked:s.isFeatured,onCheckedChange:a=>r({...s,isFeatured:a})}),e.jsx(l,{htmlFor:"featured",className:"cursor-pointer",children:"Feature this product"})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx(m,{type:"submit",disabled:p,className:"flex-1",children:p?e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"w-4 h-4 mr-2"}),i?"Update":"Create"," Product"]})}),e.jsx(m,{type:"button",variant:"outline",onClick:()=>u("/admin/products"),children:"Cancel"})]})]})})]})]})]})]})}export{me as default};
