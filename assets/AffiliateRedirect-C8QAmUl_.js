import{e as L,f as R,r as c,j as e,l as p,B as o,L as g,m as b}from"./index-fZ_4v1pA.js";import{p as E}from"./products.api-g6wHoEOU.js";import{S as x}from"./SEO-CJ6FqJ39.js";import{C as S}from"./circle-alert-DKYdrc5d.js";import{A as N}from"./arrow-left-CBAx9yF3.js";import{C as T}from"./clock-Dymh_vH7.js";import{E as A}from"./external-link-CF1zYkSy.js";function B(a,r){try{const n=new URL(a);return n.searchParams.set("utm_source","lookbook_mimi"),n.searchParams.set("utm_medium","affiliate"),n.searchParams.set("utm_campaign","product_redirect"),n.searchParams.set("utm_content",r),n.searchParams.set("ref","lookbook"),n.toString()}catch{return a}}function I(a){try{const r=new URL(a);return r.protocol==="http:"||r.protocol==="https:"}catch{return!1}}function q(){var h,j;const{id:a}=L(),r=R(),[n,v]=c.useState(3),[t,w]=c.useState(null),[f,i]=c.useState(!0),[d,m]=c.useState(null),[u,y]=c.useState("");c.useEffect(()=>{async function l(){if(!a){m("Invalid product link"),i(!1);return}try{i(!0);const s=await E.getProductById(a);if(!s){m("Product not found"),i(!1);return}if(!s.affiliateUrl){m("This product does not have a purchase link available"),i(!1);return}if(!I(s.affiliateUrl)){m("Invalid redirect URL"),i(!1);return}w(s);const C=B(s.affiliateUrl,s.id);y(C);try{const U=new URL(s.affiliateUrl);b(s.id,s.name,U.hostname)}catch{b(s.id,s.name,"unknown")}i(!1)}catch(s){console.error("Error fetching product:",s),m("Unable to load product information"),i(!1)}}l()},[a]),c.useEffect(()=>{if(!t||!u||d||f)return;const l=setInterval(()=>{v(s=>s<=1?(clearInterval(l),window.location.href=u,0):s-1)},1e3);return()=>clearInterval(l)},[t,u,d,f]);const k=()=>{u&&(window.location.href=u)},P=()=>{r(-1)};return f?e.jsxs("div",{className:"min-h-screen bg-background flex items-center justify-center",children:[e.jsx(x,{title:"Redirecting...",description:"Taking you to your selected product"}),e.jsxs("div",{className:"text-center px-4",children:[e.jsx(p,{className:"h-12 w-12 text-primary animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-neutral-600",children:"Loading product information..."})]})]}):d?e.jsxs("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:[e.jsx(x,{title:"Redirect Error",description:"Unable to complete redirect"}),e.jsx("div",{className:"max-w-md w-full text-center",children:e.jsxs("div",{className:"bg-surface rounded-2xl p-8 shadow-elegant",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-6 rounded-full bg-red-50 flex items-center justify-center",children:e.jsx(S,{className:"h-10 w-10 text-red-500"})}),e.jsx("h1",{className:"font-display text-2xl text-neutral-900 mb-3",children:d.includes("not found")?"Link Not Found":"Security Warning"}),e.jsx("p",{className:"text-neutral-600 mb-6 leading-relaxed",children:d}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[e.jsxs(o,{onClick:()=>r(-1),variant:"outline",children:[e.jsx(N,{className:"h-4 w-4 mr-2"}),"Go Back"]}),e.jsx(g,{to:"/products",children:e.jsx(o,{children:"Browse Products"})})]})]})})]}):t?e.jsxs("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:[e.jsx(x,{title:`Redirecting to ${t.brand} - ${t.name}`,description:`Taking you to purchase ${t.name} from ${t.brand}`}),e.jsxs("div",{className:"max-w-lg w-full",children:[e.jsxs("div",{className:"bg-surface rounded-2xl shadow-elegant overflow-hidden",children:[e.jsxs("div",{className:"relative h-64 bg-gradient-to-b from-neutral-100 to-neutral-50",children:[e.jsx("img",{src:t.imageUrl,alt:t.name,className:"w-full h-full object-cover object-center",onError:l=>{l.currentTarget.style.display="none"}}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/40 via-transparent to-transparent"})]}),e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"flex justify-center mb-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(p,{className:"h-12 w-12 text-primary animate-spin"}),e.jsx("div",{className:"absolute inset-0 bg-accent/20 rounded-full blur-xl animate-pulse"})]})}),e.jsxs("h1",{className:"font-display text-2xl sm:text-3xl text-neutral-900 mb-2",children:["Redirecting to ",t.brand]}),e.jsx("p",{className:"text-neutral-600 mb-1 leading-relaxed",children:"Taking you to purchase"}),e.jsx("p",{className:"font-medium text-neutral-900 mb-6",children:t.name}),e.jsx("div",{className:"mb-8",children:e.jsx("div",{className:"inline-flex items-center justify-center w-24 h-24 rounded-full bg-gradient-to-br from-accent/20 to-accent/10 border-2 border-accent/30",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-4xl font-display text-primary font-semibold",children:n}),e.jsxs("div",{className:"text-xs text-neutral-600 mt-1 flex items-center gap-1 justify-center",children:[e.jsx(T,{className:"h-3 w-3"}),"seconds"]})]})})}),e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsxs(o,{onClick:k,className:"w-full sm:w-auto min-w-[200px] h-12",size:"lg",children:["Continue Now",e.jsx(A,{className:"ml-2 h-4 w-4"})]}),e.jsx("div",{children:e.jsx(o,{onClick:P,variant:"ghost",size:"sm",className:"text-neutral-600 hover:text-neutral-900",children:"Cancel & Go Back"})})]}),e.jsxs("div",{className:"pt-6 border-t border-neutral-200",children:[e.jsxs("div",{className:"flex items-center justify-center gap-6 text-sm text-neutral-600 mb-4",children:[t.price&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs uppercase tracking-wide text-neutral-500",children:"Price"}),e.jsxs("p",{className:"font-semibold text-neutral-900",children:["$",t.price]})]}),t.category&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs uppercase tracking-wide text-neutral-500",children:"Category"}),e.jsx("p",{className:"font-medium text-neutral-900 capitalize",children:t.category})]})]}),t.tags&&t.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 justify-center mb-4",children:(j=(h=t.tags)==null?void 0:h.slice(0,3))==null?void 0:j.map((l,s)=>e.jsx("span",{className:"px-3 py-1 text-xs bg-secondary text-secondary-foreground rounded-full",children:l},s))})]}),e.jsx("div",{className:"pt-6 border-t border-neutral-200",children:e.jsxs("p",{className:"text-xs text-neutral-500 leading-relaxed",children:[e.jsx("strong",{className:"text-neutral-700",children:"Affiliate Disclosure:"})," This is an affiliate link. We may earn a commission from qualifying purchases at no additional cost to you. All prices and availability are subject to change by the retailer."]})})]})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("p",{className:"text-xs text-neutral-500",children:"You will be redirected to a secure external website"})})]})]}):e.jsxs("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:[e.jsx(x,{title:"Product Not Found",description:"This product link is no longer available"}),e.jsx("div",{className:"max-w-md w-full text-center",children:e.jsxs("div",{className:"bg-surface rounded-2xl p-8 shadow-elegant",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-6 rounded-full bg-neutral-100 flex items-center justify-center",children:e.jsx("span",{className:"text-4xl",children:"ðŸ”—"})}),e.jsx("h1",{className:"font-display text-2xl text-neutral-900 mb-3",children:"Product Not Found"}),e.jsx("p",{className:"text-neutral-600 mb-6 leading-relaxed",children:"This product link doesn't exist or may have been removed."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[e.jsxs(o,{onClick:()=>r(-1),variant:"outline",children:[e.jsx(N,{className:"h-4 w-4 mr-2"}),"Go Back"]}),e.jsx(g,{to:"/products",children:e.jsx(o,{children:"Browse Products"})})]})]})})]})}export{q as default};
