import{c as I,r as p,j as e,a as D,d as W,B as k,l as R,X as H,O as X}from"./index-Qx7ctAR2.js";import{L as q}from"./label-Bxm8bHZq.js";import{I as V}from"./input-CnM6X11f.js";import{S as Y}from"./index-C24RUjyj.js";import{a as K}from"./admin.api-Dn6gOgp3.js";import{C as U}from"./circle-check-DcfjYYcd.js";import{C as J}from"./circle-alert-CdrxB4NR.js";/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],S=I("image",Q);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],me=I("save",Z);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]],ae=I("upload",ee),te=p.forwardRef(({className:n,...c},t)=>e.jsx("textarea",{className:D("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",n),ref:t,...c}));te.displayName="Textarea";async function se(n,c=4,t=3){return new Promise((o,d)=>{const l=new FileReader;l.onload=async r=>{var m;try{const a=(m=r.target)==null?void 0:m.result,h=await _(a,c,t);o(h)}catch(a){d(a)}},l.onerror=()=>d(new Error("Failed to read file")),l.readAsDataURL(n)})}async function _(n,c=4,t=3){return new Promise((o,d)=>{const l=new Image;l.crossOrigin="Anonymous",l.onload=()=>{try{const r=document.createElement("canvas"),m=r.getContext("2d");if(!m){d(new Error("Failed to get canvas context"));return}const a=32;r.width=a,r.height=a,m.drawImage(l,0,0,a,a);const h=m.getImageData(0,0,a,a),x=Y(h.data,h.width,h.height,c,t);o(x)}catch(r){d(r)}},l.onerror=()=>d(new Error("Failed to load image")),l.src=n})}async function E(n,c={}){const{componentX:t=4,componentY:o=3}=c;return n instanceof File?se(n,t,o):_(n,t,o)}function he({id:n,label:c,value:t,onChange:o,required:d=!1,aspectRatio:l="square",disabled:r=!1,onFileSelect:m,onBlurhashGenerated:a}){const[h,x]=p.useState(null),[b,j]=p.useState(null),[y,v]=p.useState(!1),[L,g]=p.useState(!1),w=p.useRef(null),{toast:u}=W(),z={square:"aspect-square","4/3":"aspect-[4/3]","16/9":"aspect-video"}[l],A=async s=>{var C;const i=(C=s.target.files)==null?void 0:C[0];if(!i)return;if(!i.type.startsWith("image/")){u({title:"Invalid File",description:"Please select an image file",variant:"destructive"});return}const O=5*1024*1024;if(i.size>O){u({title:"File Too Large",description:"Please select an image smaller than 5MB",variant:"destructive"});return}let f=await K.uploadImage(i);console.log("this is image file"),console.log(f);const F=new FileReader;F.onloadend=async()=>{const P=F.result;x(P),j(i),m&&m(i),f&&typeof f=="object"&&"url"in f&&o(`${X.baseUrl}${f.url}`),await G(P),u({title:"Image Selected",description:"Image will be uploaded when you save"})},F.readAsDataURL(i)},G=async s=>{try{v(!0),g(!1);const i=await E(s,{componentX:4,componentY:3});a&&a(i),g(!0),u({title:"Blurhash Generated",description:"Image placeholder created automatically"})}catch(i){console.error("Failed to generate blurhash:",i),u({title:"Blurhash Generation Failed",description:"Product will work fine without it",variant:"destructive"})}finally{v(!1)}},M=async()=>{if(!(!t||t.startsWith("[LOCAL_FILE]:")))try{v(!0);const s=await E(t);a&&a(s),g(!0),u({title:"Blurhash Generated",description:"Image placeholder created from URL"})}catch(s){console.error("Failed to generate blurhash:",s),u({title:"Blurhash Generation Failed",description:"Please check the image URL and CORS settings",variant:"destructive"})}finally{v(!1)}},T=()=>{x(null),j(null),g(!1),o(""),a&&a(""),w.current&&(w.current.value="")},$=()=>{var s;(s=w.current)==null||s.click()},B=h||t,N=t.startsWith("[LOCAL_FILE]:");return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(q,{htmlFor:n,children:[c," ",d&&e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(V,{id:n,value:N?"":t,onChange:s=>{x(null),j(null),g(!1),o(s.target.value)},placeholder:"https://images.unsplash.com/photo-... or upload below",disabled:r||!!h,required:d}),e.jsxs(k,{type:"button",variant:"outline",onClick:$,disabled:r,children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Upload"]})]}),e.jsx("input",{ref:w,type:"file",accept:"image/*",onChange:A,className:"hidden",disabled:r}),N&&b&&e.jsxs("div",{className:"flex items-center justify-between p-2 bg-blue-50 dark:bg-blue-950 border border-blue-200 dark:border-blue-800 rounded text-sm text-blue-700 dark:text-blue-300",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{className:"w-4 h-4"}),e.jsxs("span",{children:[e.jsx("strong",{children:b.name})," (",(b.size/1024).toFixed(1)," KB) - Will upload on save"]})]}),y&&e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx(R,{className:"w-3 h-3 animate-spin"}),e.jsx("span",{children:"Generating placeholder..."})]}),L&&!y&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-green-600 dark:text-green-400",children:[e.jsx(U,{className:"w-3 h-3"}),e.jsx("span",{children:"Placeholder ready"})]})]}),B&&!N&&e.jsxs("div",{className:"relative mt-2",children:[e.jsxs("div",{className:`${z} max-w-[300px] rounded-lg overflow-hidden border relative group`,children:[e.jsx("img",{src:B,alt:"Preview",className:"w-full h-full object-cover",onError:s=>{s.currentTarget.src="https://images.unsplash.com/photo-1441986300917-64674bd600d8"}}),e.jsx("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:e.jsxs(k,{type:"button",variant:"destructive",size:"sm",onClick:T,disabled:r,children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"Remove"]})})]}),!h&&e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsx("div",{className:"p-2 bg-muted rounded text-xs text-muted-foreground break-all",children:t}),e.jsx(k,{type:"button",size:"sm",variant:"outline",onClick:M,disabled:r||y,className:"w-full",children:y?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"w-3 h-3 mr-2 animate-spin"}),"Generating Placeholder..."]}):L?e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"w-3 h-3 mr-2"}),"Placeholder Generated"]}):e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"w-3 h-3 mr-2"}),"Generate Blur Placeholder"]})})]})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx(J,{className:"inline w-3 h-3 mr-1"}),"Upload an image (max 5MB) or paste an image URL. Blurhash placeholder will be generated automatically."]})]})}export{he as I,me as S,te as T};
