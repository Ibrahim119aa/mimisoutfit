import{c as k,r as x,j as e,a as H,b as X,B as L,l as S,X as q,O as V}from"./index-D3NDjr5B.js";import{L as Y}from"./label-JMk-u86Z.js";import{I as K}from"./input-BdVIbqQ3.js";import{S as J}from"./index-C24RUjyj.js";import{a as Q}from"./admin.api-JLzlyybJ.js";import{C as E}from"./circle-check-Cypj3uIt.js";import{C as Z}from"./circle-alert-PPS2qJvA.js";/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],_=k("image",ee);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],ue=k("save",te);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]],se=k("upload",ae),re=x.forwardRef(({className:n,...c},a)=>e.jsx("textarea",{className:H("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",n),ref:a,...c}));re.displayName="Textarea";async function le(n,c=4,a=3){return new Promise((o,d)=>{const i=new FileReader;i.onload=async l=>{var m;try{const t=(m=l.target)==null?void 0:m.result,h=await A(t,c,a);o(h)}catch(t){d(t)}},i.onerror=()=>d(new Error("Failed to read file")),i.readAsDataURL(n)})}async function A(n,c=4,a=3){return new Promise((o,d)=>{const i=new Image;i.crossOrigin="Anonymous",i.onload=()=>{try{const l=document.createElement("canvas"),m=l.getContext("2d");if(!m){d(new Error("Failed to get canvas context"));return}const t=32;l.width=t,l.height=t,m.drawImage(i,0,0,t,t);const h=m.getImageData(0,0,t,t),g=J(h.data,h.width,h.height,c,a);o(g)}catch(l){d(l)}},i.onerror=()=>d(new Error("Failed to load image")),i.src=n})}async function z(n,c={}){const{componentX:a=4,componentY:o=3}=c;return n instanceof File?le(n,a,o):A(n,a,o)}function pe({id:n,label:c,value:a,onChange:o,required:d=!1,aspectRatio:i="square",disabled:l=!1,onFileSelect:m,onBlurhashGenerated:t}){const[h,g]=x.useState(null),[b,j]=x.useState(null),[y,v]=x.useState(!1),[I,f]=x.useState(!1),w=x.useRef(null),{toast:u}=X(),G={square:"aspect-square","4/3":"aspect-[4/3]","16/9":"aspect-video"}[i],T=async s=>{var P;const r=(P=s.target.files)==null?void 0:P[0];if(!r)return;if(!r.type.startsWith("image/")){u({title:"Invalid File",description:"Please select an image file",variant:"destructive"});return}const U=5*1024*1024;if(r.size>U){u({title:"File Too Large",description:"Please select an image smaller than 5MB",variant:"destructive"});return}let p=await Q.uploadImage(r);console.log("this is image file"),console.log(p);const F=new FileReader;F.onloadend=async()=>{const B=F.result;if(g(B),j(r),m&&m(r),p&&typeof p=="object"&&"url"in p){const C=`${p==null?void 0:p.url}`;if(!M(C)){u({title:"Invalid Image URL",description:"The uploaded image URL is not allowed.",variant:"destructive"});return}o(C)}await O(B),u({title:"Image Selected",description:"Image will be uploaded when you save"})},F.readAsDataURL(r)},M=s=>{try{const r=new URL(s,V.baseUrl);return["http:","https:"].includes(r.protocol)}catch(r){return console.log("URL parsing error:",r),!1}},O=async s=>{try{v(!0),f(!1);const r=await z(s,{componentX:4,componentY:3});t&&t(r),f(!0),u({title:"Blurhash Generated",description:"Image placeholder created automatically"})}catch(r){console.error("Failed to generate blurhash:",r),u({title:"Blurhash Generation Failed",description:"Product will work fine without it",variant:"destructive"})}finally{v(!1)}},$=async()=>{if(!(!a||a.startsWith("[LOCAL_FILE]:")))try{v(!0);const s=await z(a);t&&t(s),f(!0),u({title:"Blurhash Generated",description:"Image placeholder created from URL"})}catch(s){console.error("Failed to generate blurhash:",s),u({title:"Blurhash Generation Failed",description:"Please check the image URL and CORS settings",variant:"destructive"})}finally{v(!1)}},D=()=>{g(null),j(null),f(!1),o(""),t&&t(""),w.current&&(w.current.value="")},W=()=>{var s;(s=w.current)==null||s.click()},R=h||a,N=a.startsWith("[LOCAL_FILE]:");return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Y,{htmlFor:n,children:[c," ",d&&e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(K,{id:n,value:N?"":a,onChange:s=>{g(null),j(null),f(!1),o(s.target.value)},placeholder:"https://images.unsplash.com/photo-... or upload below",disabled:l||!!h,required:d}),e.jsxs(L,{type:"button",variant:"outline",onClick:W,disabled:l,children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Upload"]})]}),e.jsx("input",{ref:w,type:"file",accept:"image/*",onChange:T,className:"hidden",disabled:l}),N&&b&&e.jsxs("div",{className:"flex items-center justify-between p-2 bg-blue-50 dark:bg-blue-950 border border-blue-200 dark:border-blue-800 rounded text-sm text-blue-700 dark:text-blue-300",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{className:"w-4 h-4"}),e.jsxs("span",{children:[e.jsx("strong",{children:b.name})," (",(b.size/1024).toFixed(1)," KB) - Will upload on save"]})]}),y&&e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx(S,{className:"w-3 h-3 animate-spin"}),e.jsx("span",{children:"Generating placeholder..."})]}),I&&!y&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-green-600 dark:text-green-400",children:[e.jsx(E,{className:"w-3 h-3"}),e.jsx("span",{children:"Placeholder ready"})]})]}),R&&!N&&e.jsxs("div",{className:"relative mt-2",children:[e.jsxs("div",{className:`${G} max-w-[300px] rounded-lg overflow-hidden border relative group`,children:[e.jsx("img",{src:R,alt:"Preview",className:"w-full h-full object-cover",onError:s=>{s.currentTarget.src="https://images.unsplash.com/photo-1441986300917-64674bd600d8"}}),e.jsx("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:e.jsxs(L,{type:"button",variant:"destructive",size:"sm",onClick:D,disabled:l,children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Remove"]})})]}),!h&&e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsx("div",{className:"p-2 bg-muted rounded text-xs text-muted-foreground break-all",children:a}),e.jsx(L,{type:"button",size:"sm",variant:"outline",onClick:$,disabled:l||y,className:"w-full",children:y?e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"w-3 h-3 mr-2 animate-spin"}),"Generating Placeholder..."]}):I?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"w-3 h-3 mr-2"}),"Placeholder Generated"]}):e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"w-3 h-3 mr-2"}),"Generate Blur Placeholder"]})})]})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx(Z,{className:"inline w-3 h-3 mr-1"}),"Upload an image (max 5MB) or paste an image URL. Blurhash placeholder will be generated automatically."]})]})}export{pe as I,ue as S,re as T};
