var B=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","#","$","%","*","+",",","-",".",":",";","=","?","@","[","]","^","_","{","|","}","~"],p=t=>{let r=0;for(let e=0;e<t.length;e++){let l=t[e],o=B.indexOf(l);r=r*83+o}return r},b=(t,r)=>{var e="";for(let l=1;l<=r;l++){let o=Math.floor(t)/Math.pow(83,r-l)%83;e+=B[Math.floor(o)]}return e},c=t=>{let r=t/255;return r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)},g=t=>{let r=Math.max(0,Math.min(1,t));return r<=.0031308?Math.trunc(r*12.92*255+.5):Math.trunc((1.055*Math.pow(r,.4166666666666667)-.055)*255+.5)},O=t=>t<0?-1:1,w=(t,r)=>O(t)*Math.pow(Math.abs(t),r),I=class extends Error{constructor(t){super(t),this.name="ValidationError",this.message=t}},T=t=>{if(!t||t.length<6)throw new I("The blurhash string must be at least 6 characters");let r=p(t[0]),e=Math.floor(r/9)+1,l=r%9+1;if(t.length!==4+2*l*e)throw new I(`blurhash length mismatch: length is ${t.length} but it should be ${4+2*l*e}`)},U=t=>{let r=t>>16,e=t>>8&255,l=t&255;return[c(r),c(e),c(l)]},V=(t,r)=>{let e=Math.floor(t/361),l=Math.floor(t/19)%19,o=t%19;return[w((e-9)/9,2)*r,w((l-9)/9,2)*r,w((o-9)/9,2)*r]},j=(t,r,e,l)=>{T(t),l=l|1;let o=p(t[0]),i=Math.floor(o/9)+1,u=o%9+1,m=(p(t[1])+1)/166,n=new Array(u*i);for(let a=0;a<n.length;a++)if(a===0){let h=p(t.substring(2,6));n[a]=U(h)}else{let h=p(t.substring(4+a*2,6+a*2));n[a]=V(h,m*l)}let M=r*4,s=new Uint8ClampedArray(M*e);for(let a=0;a<e;a++)for(let h=0;h<r;h++){let f=0,x=0,d=0;for(let v=0;v<i;v++)for(let y=0;y<u;y++){let E=Math.cos(Math.PI*h*y/r)*Math.cos(Math.PI*a*v/e),A=n[y+v*u];f+=A[0]*E,x+=A[1]*E,d+=A[2]*E}let P=g(f),C=g(x),H=g(d);s[4*h+0+a*M]=P,s[4*h+1+a*M]=C,s[4*h+2+a*M]=H,s[4*h+3+a*M]=255}return s},G=j,$=4,q=(t,r,e,l)=>{let o=0,i=0,u=0,m=r*$;for(let M=0;M<r;M++){let s=$*M;for(let a=0;a<e;a++){let h=s+a*m,f=l(M,a);o+=f*c(t[h]),i+=f*c(t[h+1]),u+=f*c(t[h+2])}}let n=1/(r*e);return[o*n,i*n,u*n]},z=t=>{let r=g(t[0]),e=g(t[1]),l=g(t[2]);return(r<<16)+(e<<8)+l},D=(t,r)=>{let e=Math.floor(Math.max(0,Math.min(18,Math.floor(w(t[0]/r,.5)*9+9.5)))),l=Math.floor(Math.max(0,Math.min(18,Math.floor(w(t[1]/r,.5)*9+9.5)))),o=Math.floor(Math.max(0,Math.min(18,Math.floor(w(t[2]/r,.5)*9+9.5))));return e*19*19+l*19+o},F=(t,r,e,l,o)=>{if(l<1||l>9||o<1||o>9)throw new I("BlurHash must have between 1 and 9 components");if(r*e*4!==t.length)throw new I("Width and height must match the pixels array");let i=[];for(let a=0;a<o;a++)for(let h=0;h<l;h++){let f=h==0&&a==0?1:2,x=q(t,r,e,(d,P)=>f*Math.cos(Math.PI*h*d/r)*Math.cos(Math.PI*a*P/e));i.push(x)}let u=i[0],m=i.slice(1),n="",M=l-1+(o-1)*9;n+=b(M,1);let s;if(m.length>0){let a=Math.max(...m.map(f=>Math.max(...f))),h=Math.floor(Math.max(0,Math.min(82,Math.floor(a*166-.5))));s=(h+1)/166,n+=b(h,1)}else s=1,n+=b(0,1);return n+=b(z(u),4),m.forEach(a=>{n+=b(D(a,s),2)}),n},L=F;export{L as S,G as j};
